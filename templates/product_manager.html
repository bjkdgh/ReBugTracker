{% extends "base.html" %}

{% block content %}
</script>
<style>
    .dashboard-container {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        min-height: calc(100vh - 80px);
        padding: 20px 0;
    }

    .dashboard-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 20px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
    }

    .dashboard-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .header-content {
        position: relative;
        z-index: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    .header-left h1 {
        margin: 0;
        font-size: 2.5rem;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .header-left p {
        margin: 5px 0 0 0;
        font-size: 1.1rem;
        opacity: 0.9;
    }

    .welcome-time {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-top: 5px;
    }

    .header-right {
        text-align: right;
    }

    .user-name {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .user-role {
        font-size: 1rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 5px;
        justify-content: flex-end;
    }

    .main-content {
        max-width: 1600px;
        margin: 0 auto;
        padding: 0 20px;
        width: 100%;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 5px solid;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
        animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    .stat-card.total {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-left-color: #667eea;
    }

    .stat-card.pending {
        background: linear-gradient(135deg, #ffa726 0%, #ff9800 100%);
        color: white;
        border-left-color: #ffa726;
    }

    .stat-card.processing {
        background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
        color: white;
        border-left-color: #42a5f5;
    }

    .stat-card.resolved {
        background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
        color: white;
        border-left-color: #66bb6a;
    }

    .stat-card.closed {
        background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
        color: white;
        border-left-color: #9c27b0;
    }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .stat-title {
        font-size: 0.9rem;
        color: #666;
        font-weight: 500;
    }

    .stat-card.total .stat-title,
    .stat-card.pending .stat-title,
    .stat-card.processing .stat-title,
    .stat-card.resolved .stat-title,
    .stat-card.closed .stat-title {
        color: rgba(255, 255, 255, 0.9);
    }

    .stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }

    .stat-card.total .stat-icon { background: #667eea; }
    .stat-card.pending .stat-icon { background: #ffa726; }
    .stat-card.processing .stat-icon { background: #42a5f5; }
    .stat-card.resolved .stat-icon { background: #66bb6a; }
    .stat-card.closed .stat-icon { background: #9c27b0; }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .stat-card.total .stat-number,
    .stat-card.pending .stat-number,
    .stat-card.processing .stat-number,
    .stat-card.resolved .stat-number,
    .stat-card.closed .stat-number {
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .stat-change {
        font-size: 0.8rem;
        color: #666;
    }

    .stat-card.total .stat-change,
    .stat-card.pending .stat-change,
    .stat-card.processing .stat-change,
    .stat-card.resolved .stat-change,
    .stat-card.closed .stat-change {
        color: rgba(255, 255, 255, 0.9);
    }

    /* 产品线卡片样式 */
    .product-line-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 5px solid;
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .product-line-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    .product-line-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .product-line-title {
        font-size: 1.1rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
    }

    .product-line-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }

    .product-line-total {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .product-line-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        font-size: 0.9rem;
    }

    .detail-item {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .detail-label {
        color: #667eea;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .detail-value {
        font-weight: 600;
        color: #333;
    }

    /* 产品线卡片颜色主题 */
    .product-line-card.theme-1 { border-left-color: #667eea; }
    .product-line-card.theme-1 .product-line-icon { background: #667eea; }

    .product-line-card.theme-2 { border-left-color: #ff9a9e; }
    .product-line-card.theme-2 .product-line-icon { background: #ff9a9e; }

    .product-line-card.theme-3 { border-left-color: #ffecd2; }
    .product-line-card.theme-3 .product-line-icon { background: #ffa726; }

    .product-line-card.theme-4 { border-left-color: #a8edea; }
    .product-line-card.theme-4 .product-line-icon { background: #42a5f5; }

    .product-line-card.theme-5 { border-left-color: #84fab0; }
    .product-line-card.theme-5 .product-line-icon { background: #66bb6a; }

    .product-line-card.theme-6 { border-left-color: #a8e6cf; }
    .product-line-card.theme-6 .product-line-icon { background: #4caf50; }

    .product-line-card.theme-7 { border-left-color: #d299c2; }
    .product-line-card.theme-7 .product-line-icon { background: #9c27b0; }

    .product-line-card.theme-8 { border-left-color: #ff8a80; }
    .product-line-card.theme-8 .product-line-icon { background: #f44336; }

    .product-line-card.theme-9 { border-left-color: #ffcc80; }
    .product-line-card.theme-9 .product-line-icon { background: #ff9800; }

    .product-line-card.theme-10 { border-left-color: #c5e1a5; }
    .product-line-card.theme-10 .product-line-icon { background: #8bc34a; }

    /* 激活状态样式 */
    .product-line-card.active {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        border-left-width: 8px;
    }

    .product-line-card.active::after {
        content: '✓';
        position: absolute;
        top: 10px;
        right: 10px;
        background: #4caf50;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
    }

    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }

    .quick-action-btn {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        padding: 25px 20px;
        text-align: center;
        text-decoration: none;
        color: #333;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .quick-action-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
        transition: left 0.5s ease;
    }

    .quick-action-btn:hover::before {
        left: 100%;
    }

    .quick-action-btn:hover {
        border-color: #667eea;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-decoration: none;
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .quick-action-btn:hover .quick-action-desc {
        color: rgba(255, 255, 255, 0.9);
    }

    .quick-action-icon {
        font-size: 2rem;
        margin-bottom: 5px;
    }

    .quick-action-title {
        font-weight: 600;
        font-size: 1rem;
    }

    .quick-action-desc {
        font-size: 0.8rem;
        color: #666;
        margin: 0;
    }

    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    .content-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .content-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
    }

    .content-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
    }

    .card-header {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        margin: -30px -30px 25px -30px;
        padding: 30px 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px 20px 0 0;
        position: relative;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        min-height: 90px; /* 确保标题区域有足够高度 */
    }

    .card-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    }

    .card-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: white;
        display: flex;
        align-items: center;
        gap: 15px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        margin: 0;
        flex: 1; /* 占用可用空间 */
        line-height: 1.4; /* 增加行高 */
        letter-spacing: 0.5px; /* 增加字母间距 */
    }

    .card-title i {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.2rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .product-line-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .product-line-item {
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .product-line-item:hover {
        background: #f8f9fa;
        border-color: #667eea;
        transform: translateX(5px);
    }

    .product-line-name {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
    }

    .product-line-desc {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 10px;
    }

    .product-line-stats {
        display: flex;
        gap: 15px;
        font-size: 0.8rem;
    }

    .stat-badge {
        background: #f0f0f0;
        padding: 3px 8px;
        border-radius: 12px;
        color: #666;
    }

    .chart-container {
        height: 300px;
        position: relative;
    }

    .bugs-table-container {
        grid-column: 1 / -1;
        background: white;
        border-radius: 20px;
        padding: 0;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.8);
        overflow: hidden;
        width: 100%;
        min-width: 0; /* 确保容器可以收缩 */
    }

    .bugs-table-container .card-header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        margin: 0 0 25px 0; /* 重置margin，避免负值影响 */
        padding: 30px 40px;
    }

    .bugs-table-container .table-responsive {
        padding: 25px;
    }

    /* 为不同卡片设置不同的颜色主题 */
    .chart-section .card-header {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .teams-section .card-header {
        background: linear-gradient(135deg, #a8e6cf 0%, #26de81 100%);
        box-shadow: 0 4px 15px rgba(168, 230, 207, 0.3);
    }

    /* 添加卡片内容区域的padding */
    .content-card .chart-container,
    .content-card .teams-stats {
        padding: 0 5px;
    }

    .table-responsive {
        overflow-x: auto;
    }

    .table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 4px;
        margin-top: 15px;
    }

    .table th,
    .table td {
        padding: 14px 12px;
        text-align: left;
        border: none;
    }

    .table tr {
        border-radius: 8px;
        overflow: hidden;
    }

    .table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-weight: 600;
        color: white;
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        border-radius: 8px 8px 0 0;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .table th:first-child {
        border-radius: 8px 0 0 0;
    }

    .table th:last-child {
        border-radius: 0 8px 0 0;
    }

    .status-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
        display: inline-block;
        min-width: 70px;
    }

    .status-pending { background: #fff3e0; color: #f57c00; }
    .status-assigned { background: #e3f2fd; color: #1976d2; }
    .status-processing { background: #e8f5e8; color: #388e3c; }
    .status-resolved { background: #f3e5f5; color: #7b1fa2; }
    .status-rejected { background: #ffebee; color: #d32f2f; }
    .status-completed { background: #e0f2f1; color: #00796b; }

    .loading {
        text-align: center;
        padding: 40px;
        color: #666;
    }

    @media (max-width: 768px) {
        .content-grid {
            grid-template-columns: 1fr;
        }
        
        .header-content {
            flex-direction: column;
            text-align: center;
        }
        
        .header-right {
            text-align: center;
        }
        
        .user-role {
            justify-content: center;
        }
    }

    /* 顶部导航栏样式 */
    .top-navbar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .navbar-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 30px;
        max-width: 100%;
    }

    .navbar-left {
        display: flex;
        align-items: center;
        gap: 30px;
    }

    .logo-section {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5rem;
        font-weight: 700;
    }

    .logo-text {
        background: linear-gradient(45deg, #fff, #f0f8ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .nav-title {
        font-size: 1.2rem;
        font-weight: 600;
        opacity: 0.9;
    }

    .navbar-right {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .nav-user-info {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 2px;
    }

    .nav-user-info .user-name {
        font-size: 1.1rem;
        font-weight: 600;
    }

    .nav-user-info .user-role {
        font-size: 0.9rem;
        opacity: 0.8;
    }

    .nav-actions {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .nav-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 10px 12px;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 44px;
        height: 44px;
    }

    .nav-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .logout-btn:hover {
        background: rgba(220, 53, 69, 0.8);
        border-color: rgba(220, 53, 69, 0.8);
    }

    .notification-btn {
        position: relative;
    }

    .notification-icon {
        position: relative;
    }

    .notification-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 10px;
        min-width: 18px;
        text-align: center;
        font-weight: 600;
    }

    .notification-dropdown {
        min-width: 350px;
        max-height: 400px;
        overflow-y: auto;
        border: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
    }

    .notification-item {
        border-bottom: 1px solid #eee;
        padding: 15px;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .notification-item:hover {
        background-color: #f8f9fa;
    }

    .notification-item.unread {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
    }

    .notification-title {
        font-weight: 600;
        margin-bottom: 5px;
        color: #333;
    }

    .notification-content {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .notification-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
        color: #999;
    }

    .notification-time, .notification-status {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .notification-status.unread {
        color: #2196f3;
        font-weight: 600;
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
        .navbar-content {
            padding: 10px 15px;
        }

        .navbar-left {
            gap: 15px;
        }

        .nav-title {
            display: none;
        }

        .nav-user-info {
            display: none;
        }

        .nav-actions {
            gap: 8px;
        }

        .nav-btn {
            padding: 8px 10px;
            min-width: 40px;
            height: 40px;
        }
    }

    /* 新增样式 - 概览统计 (仿照admin页面色彩) */
    .overview-section {
        margin-bottom: 30px;
    }

    .overview-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 16px;
    }

    .overview-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        border: 1px solid #e8eaed;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 14px;
        position: relative;
        overflow: hidden;
    }

    .overview-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .overview-card.total {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    .overview-card.pending {
        background: linear-gradient(135deg, #ffa726 0%, #ff8f00 100%);
        color: white;
    }
    .overview-card.assigned {
        background: linear-gradient(135deg, #42a5f5 0%, #1976d2 100%);
        color: white;
    }
    .overview-card.processing {
        background: linear-gradient(135deg, #66bb6a 0%, #388e3c 100%);
        color: white;
    }
    .overview-card.resolved {
        background: linear-gradient(135deg, #ab47bc 0%, #7b1fa2 100%);
        color: white;
    }
    .overview-card.completed {
        background: linear-gradient(135deg, #ef5350 0%, #c62828 100%);
        color: white;
    }

    .card-icon {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
    }

    .card-content {
        flex: 1;
    }

    .card-number {
        font-size: 24px;
        font-weight: 700;
        color: inherit;
        line-height: 1;
        margin-bottom: 4px;
    }

    .card-label {
        font-size: 13px;
        color: inherit;
        opacity: 0.9;
        font-weight: 500;
    }

    /* 产品线选择器样式 */
    .product-line-selector {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid #f0f0f0;
        margin-bottom: 30px;
    }

    .selector-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .selector-header h3 {
        margin: 0;
        color: #333;
        font-size: 18px;
        font-weight: 600;
    }

    .btn-reset {
        background: linear-gradient(135deg, #6c757d, #5a6268);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-reset:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }

    .selector-content {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
    }

    .product-line-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 8px 14px;
        border-radius: 18px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .product-line-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .product-line-btn.active {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
    }

    /* 主仪表板样式 */
    .main-dashboard {
        margin-bottom: 30px;
    }

    .dashboard-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    .chart-section,
    .teams-section {
        min-height: 400px;
    }

    .teams-stats {
        max-height: 320px;
        overflow-y: auto;
        padding: 10px;
    }

    .team-stat-item {
        background: white;
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 8px;
        border: 1px solid #e8eaed;
        transition: all 0.3s ease;
        cursor: pointer;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .team-stat-item:hover {
        background: #f8f9fa;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .team-stat-item.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
    }

    .team-name {
        font-weight: 600;
        margin-bottom: 6px;
        font-size: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .team-stats-row {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
        font-size: 12px;
        opacity: 0.8;
    }

    .team-stat-item.active .team-stats-row {
        opacity: 0.9;
    }

    .team-stats-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        margin-bottom: 8px;
        background: linear-gradient(135deg, #f8f9ff 0%, #e8eaff 100%);
        border-radius: 8px;
        border: 1px solid #e0e4ff;
    }

    .team-name-header {
        font-weight: 700;
        color: #667eea;
        font-size: 13px;
    }

    .team-member-count {
        font-weight: 600;
        font-size: 13px;
    }

    @media (max-width: 768px) {
        .dashboard-row {
            grid-template-columns: 1fr;
        }

        .overview-cards {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .selector-content {
            justify-content: center;
        }
    }
</style>

<!-- 顶部导航栏 -->
<nav class="top-navbar">
    <div class="navbar-content">
        <div class="navbar-left">
            <div class="logo-section">
                <i class="fas fa-bug"></i>
                <span class="logo-text">ReBugTracker</span>
            </div>
            <div class="nav-title">产品经理工作台</div>
        </div>
        <div class="navbar-right">

            <div class="nav-actions">
                <!-- 通知按钮 -->
                <div class="dropdown">
                    <button class="nav-btn notification-btn" type="button" data-bs-toggle="dropdown">
                        <div class="notification-icon">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </div>
                    </button>
                    <ul class="dropdown-menu notification-dropdown" id="notificationList">
                        <li class="text-center p-3">
                            <i class="fas fa-spinner fa-spin"></i>
                            <div>加载中...</div>
                        </li>
                    </ul>
                </div>

                <!-- 用户设置 -->
                <a href="/user-settings" class="nav-btn" title="个人设置">
                    <i class="fas fa-cog"></i>
                </a>

                <!-- 退出登录 -->
                <a href="/logout" class="nav-btn logout-btn" title="退出登录">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </div>
    </div>
</nav>

<div class="dashboard-container">
    <div class="main-content">
        <!-- 页面头部 -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-left">
                    <h1>
                        <i class="fas fa-home"></i>
                        欢迎回来，{{ user.chinese_name or user.username }}
                    </h1>
                    <p>产品经理专属工作台 - 管理您的产品线和团队</p>
                    <div class="welcome-time" id="currentTime"></div>
                </div>
                <div class="header-right">
                    <div class="user-name">{{ user.chinese_name or user.username }}</div>
                    <div class="user-role">
                        <i class="fas fa-user-tie"></i>
                        产品经理
                    </div>
                    <div class="user-role" style="margin-top: 5px; font-size: 0.9rem;">
                        <i class="fas fa-users"></i>
                        负责团队：<span id="userTeams">{{ user.team }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 概览统计 -->
        <div class="overview-section">
            <div class="overview-cards">
                <div class="overview-card total">
                    <div class="card-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number" id="totalBugs">-</div>
                        <div class="card-label">总问题数</div>
                    </div>
                </div>

                <div class="overview-card pending">
                    <div class="card-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number" id="pendingBugs">-</div>
                        <div class="card-label">待处理</div>
                    </div>
                </div>

                <div class="overview-card assigned">
                    <div class="card-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number" id="assignedBugs">-</div>
                        <div class="card-label">已分配</div>
                    </div>
                </div>

                <div class="overview-card processing">
                    <div class="card-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number" id="processingBugs">-</div>
                        <div class="card-label">处理中</div>
                    </div>
                </div>

                <div class="overview-card resolved">
                    <div class="card-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number" id="resolvedBugs">-</div>
                        <div class="card-label">已解决</div>
                    </div>
                </div>

                <div class="overview-card completed">
                    <div class="card-icon">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number" id="completedBugs">-</div>
                        <div class="card-label">已完成</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 产品线选择器 -->
        <div class="product-line-selector">
            <div class="selector-header">
                <h3><i class="fas fa-filter"></i> 产品线筛选</h3>
                <button class="btn-reset" onclick="showAllIssues()">
                    <i class="fas fa-refresh"></i> 显示全部
                </button>
            </div>
            <div class="selector-content" id="productLineSelector">
                <!-- 产品线选择按钮将通过JavaScript动态生成 -->
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="main-dashboard">
            <!-- 隐藏的产品线统计容器 -->
            <div id="productLineStats" style="display: none;"></div>
            <!-- 图表和团队统计 -->
            <div class="dashboard-row">
                <!-- 状态分布图表 -->
                <div class="chart-section">
                    <div class="content-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                问题状态分布
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 产品线团队统计 -->
                <div class="teams-section">
                    <div class="content-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-users"></i>
                                产品线团队统计
                            </h3>
                        </div>
                        <div class="teams-stats" id="productLinesContainer">
                            <div class="loading">
                                <i class="fas fa-spinner fa-spin"></i> 加载中...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bug列表 -->
        <div class="bugs-table-container">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-list"></i>
                    我的团队问题列表
                </h3>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>标题</th>
                            <th>负责人团队</th>
                            <th>状态</th>
                            <th>创建人</th>
                            <th>负责人</th>
                            <th>创建时间</th>
                        </tr>
                    </thead>
                    <tbody id="bugsTableBody">
                        <tr>
                            <td colspan="7" class="loading">
                                <i class="fas fa-spinner fa-spin"></i> 加载中...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<script>
let productLines = [];
let bugs = [];
let statusChart = null;

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    updateCurrentTime();
    loadStatistics();
    loadTeams();
    loadBugs();

    // 每分钟更新一次时间
    setInterval(updateCurrentTime, 60000);
});

// 更新当前时间
function updateCurrentTime() {
    const now = new Date();
    const options = {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long',
        hour: '2-digit',
        minute: '2-digit'
    };

    const timeString = now.toLocaleDateString('zh-CN', options);
    const greeting = getGreeting(now.getHours());

    document.getElementById('currentTime').textContent = `${greeting} - ${timeString}`;
}

// 根据时间获取问候语
function getGreeting(hour) {
    if (hour < 6) return '夜深了，注意休息';
    if (hour < 9) return '早上好';
    if (hour < 12) return '上午好';
    if (hour < 14) return '中午好';
    if (hour < 18) return '下午好';
    if (hour < 22) return '晚上好';
    return '夜深了，注意休息';
}

// 加载统计数据
async function loadStatistics() {
    try {
        // 加载团队数据和bug数据
        const [teamsResponse, bugsResponse] = await Promise.all([
            fetch('/api/product-manager/my-teams'),
            fetch('/api/product-manager/bugs')
        ]);
        
        const [teamsResult, bugsResult] = await Promise.all([
            teamsResponse.json(),
            bugsResponse.json()
        ]);

        console.log('Teams data:', teamsResult);
        console.log('Bugs data:', bugsResult);

        if (teamsResult.success && teamsResult.data.length > 0) {
            // 确保bugs数据正确
            if (!bugsResult.success || !Array.isArray(bugsResult.data)) {
                console.error('Invalid bugs data:', bugsResult);
                bugsResult.data = [];
            }
            
            const processedTeams = teamsResult.data.map(team => {
                // 过滤出该团队的bugs
                const teamBugs = bugsResult.success ? bugsResult.data.filter(bug => 
                    bug.assignee_team === team.name
                ) : [];

                console.log(`Processing team ${team.name}:`, teamBugs);
                
                return {
                    ...team,
                    bug_stats: {
                        total: teamBugs.length,
                        pending: teamBugs.filter(b => b.status === '待处理').length,
                        assigned: teamBugs.filter(b => b.status === '已分配').length,
                        processing: teamBugs.filter(b => b.status === '处理中').length,
                        resolved: teamBugs.filter(b => b.status === '已解决').length,
                        closed: teamBugs.filter(b => b.status === '已完成').length
                    }
                };
            });

            // 更新全局bugs数组
            bugs = bugsResult.success ? bugsResult.data : [];
            
            // 生成统计数据
            generateProductLineStats(processedTeams);
            updateOverviewStats();
        } else {
            document.getElementById('productLineStats').innerHTML =
                '<p style="color: #666; text-align: center; grid-column: 1 / -1;">暂无分配的产品线</p>';
        }
    } catch (error) {
        console.error('加载统计数据失败:', error);
        document.getElementById('productLineStats').innerHTML =
            '<p style="color: #f44336; text-align: center; grid-column: 1 / -1;">加载失败</p>';
    }
}

// 生成产品线统计卡片
function generateProductLineStats(teams) {
    const container = document.getElementById('productLineStats');
    container.innerHTML = '';

    for (let i = 0; i < teams.length; i++) {
        const team = teams[i];
        const themeClass = `theme-${(i % 10) + 1}`;

        // 使用团队数据中的bug_stats
        const stats = team.bug_stats;

        const cardHtml = `
            <div class="product-line-card ${themeClass}" onclick="filterByProductLine('${team.name}')">
                <div class="product-line-header">
                    <h3 class="product-line-title">${team.name}</h3>
                    <div class="product-line-icon">
                        <i class="fas fa-building"></i>
                    </div>
                </div>
                <div class="product-line-total">${stats.total}</div>
                <div class="product-line-details">
                    <div class="detail-item">
                        <span class="detail-label">待处理</span>
                        <span class="detail-value" style="color: #ffa726; font-weight: 700;">${stats.pending || 0}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">已分配</span>
                        <span class="detail-value" style="color: #42a5f5; font-weight: 700;">${stats.assigned || 0}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">处理中</span>
                        <span class="detail-value" style="color: #66bb6a; font-weight: 700;">${stats.processing || 0}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">已解决</span>
                        <span class="detail-value" style="color: #ab47bc; font-weight: 700;">${stats.resolved || 0}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">已完成</span>
                        <span class="detail-value" style="color: #ef5350; font-weight: 700;">${stats.closed || 0}</span>
                    </div>
                </div>
            </div>
        `;

        container.innerHTML += cardHtml;
    }
}



// 加载团队数据
async function loadTeams() {
    try {
        const response = await fetch('/api/product-manager/my-teams');
        const result = await response.json();

        if (result.success) {
            renderTeams(result.data);
        } else {
            document.getElementById('productLinesContainer').innerHTML =
                '<p style="color: #666; text-align: center;">暂无分配的团队</p>';
        }
    } catch (error) {
        console.error('加载团队失败:', error);
        document.getElementById('productLinesContainer').innerHTML =
            '<p style="color: #f44336; text-align: center;">加载失败</p>';
    }
}

// 渲染概览统计
function updateOverviewStats() {
    const total = bugs.length;
    const pending = bugs.filter(b => b.status === '待处理').length;
    const assigned = bugs.filter(b => b.status === '已分配').length;
    const processing = bugs.filter(b => b.status === '处理中').length;
    const resolved = bugs.filter(b => b.status === '已解决').length;
    const completed = bugs.filter(b => b.status === '已完成').length;

    document.getElementById('totalBugs').textContent = total;
    document.getElementById('pendingBugs').textContent = pending;
    document.getElementById('assignedBugs').textContent = assigned;
    document.getElementById('processingBugs').textContent = processing;
    document.getElementById('resolvedBugs').textContent = resolved;
    document.getElementById('completedBugs').textContent = completed;
}

// 渲染产品线选择器
function renderProductLineSelector(teams) {
    const container = document.getElementById('productLineSelector');

    if (!teams || teams.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">暂无团队数据</p>';
        return;
    }

    const html = teams.map(team => `
        <button class="product-line-btn" onclick="filterByProductLine('${team.name}')">
            ${team.name} (${team.bug_stats.total})
        </button>
    `).join('');

    container.innerHTML = html;
}

// 渲染团队列表
function renderTeams(teams) {
    const container = document.getElementById('productLinesContainer');

    if (teams.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center;">暂无分配的团队</p>';
        return;
    }

    // 添加标题行
    const headerHtml = `
        <div class="team-stats-header">
            <div class="team-name-header">团队名称</div>
            <div class="team-stats-row">
                <span style="color: #ffa726; font-weight: 700; font-size: 11px;">待处理</span>
                <span style="color: #42a5f5; font-weight: 700; font-size: 11px;">已分配</span>
                <span style="color: #66bb6a; font-weight: 700; font-size: 11px;">处理中</span>
                <span style="color: #ab47bc; font-weight: 700; font-size: 11px;">已解决</span>
                <span style="color: #ef5350; font-weight: 700; font-size: 11px;">已完成</span>
            </div>
        </div>
    `;

    const html = teams.map(team => `
        <div class="team-stat-item" onclick="filterByProductLine('${team.name}')">
            <div class="team-name">
                ${team.name}
                <span class="team-member-count">${team.member_count}人</span>
            </div>
            <div class="team-stats-row">
                <span style="color: #ffa726; font-weight: 600;">${team.bug_stats.pending || 0}</span>
                <span style="color: #42a5f5; font-weight: 600;">${team.bug_stats.assigned || 0}</span>
                <span style="color: #66bb6a; font-weight: 600;">${team.bug_stats.processing || 0}</span>
                <span style="color: #ab47bc; font-weight: 600;">${team.bug_stats.resolved || 0}</span>
                <span style="color: #ef5350; font-weight: 600;">${team.bug_stats.closed || 0}</span>
            </div>
        </div>
    `).join('');

    container.innerHTML = headerHtml + html;

    // 同时更新产品线选择器
    renderProductLineSelector(teams);
}

// 加载Bug数据
async function loadBugs() {
    try {
        const response = await fetch('/api/product-manager/bugs');
        const result = await response.json();
        
        if (result.success) {
            bugs = result.data;
            updateOverviewStats(); // 更新概览统计
            renderBugsTable();
            renderStatusChart(); // 渲染状态分布图表
        } else {
            document.getElementById('bugsTableBody').innerHTML = 
                '<tr><td colspan="7" style="text-align: center; color: #666;">暂无数据</td></tr>';
        }
    } catch (error) {
        console.error('加载Bug数据失败:', error);
        document.getElementById('bugsTableBody').innerHTML = 
            '<tr><td colspan="7" style="text-align: center; color: #f44336;">加载失败</td></tr>';
    }
}

// 更新统计数据
function updateStatistics() {
    const total = bugs.length;
    const pending = bugs.filter(b => b.status === '待处理').length;
    const processing = bugs.filter(b => ['已分配', '处理中'].includes(b.status)).length;
    const resolved = bugs.filter(b => ['已解决', '已完成'].includes(b.status)).length;
    
    document.getElementById('totalBugs').textContent = total;
    document.getElementById('pendingBugs').textContent = pending;
    document.getElementById('processingBugs').textContent = processing;
    document.getElementById('resolvedBugs').textContent = resolved;
}

// 渲染Bug表格
function renderBugsTable(filteredBugs = null) {
    const tbody = document.getElementById('bugsTableBody');
    const bugsToRender = filteredBugs || bugs;

    if (bugsToRender.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">暂无数据</td></tr>';
        return;
    }

    // 定义状态对应的行背景色
    const getRowStyle = (status) => {
        const statusStyles = {
            '待处理': 'background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-left: 4px solid #ffa726;',
            '已分配': 'background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-left: 4px solid #42a5f5;',
            '处理中': 'background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%); border-left: 4px solid #66bb6a;',
            '已解决': 'background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-left: 4px solid #ab47bc;',
            '已完成': 'background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); border-left: 4px solid #ef5350;',
            '已驳回': 'background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%); border-left: 4px solid #9e9e9e;'
        };
        return statusStyles[status] || 'background: #ffffff; border-left: 4px solid #e0e0e0;';
    };

    const html = bugsToRender.map((bug, index) => `
        <tr onclick="window.open('/bug/${bug.id}', '_blank')"
            style="cursor: pointer; ${getRowStyle(bug.status)} transition: all 0.3s ease; margin-bottom: 2px;"
            onmouseover="this.style.transform='translateX(5px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';"
            onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='none';">
            <td style="font-weight: 600; color: #667eea;">#${bug.id}</td>
            <td style="font-weight: 500; color: #333;">${bug.title}</td>
            <td style="color: #666;">${bug.assignee_team || '未分配'}</td>
            <td><span class="status-badge status-${getStatusClass(bug.status)}">${bug.status}</span></td>
            <td style="color: #666;">${bug.creator_name || '未知'}</td>
            <td style="color: #666;">${bug.assignee_name || '未分配'}</td>
            <td style="color: #999; font-size: 0.9rem;">${formatDate(bug.created_at)}</td>
        </tr>
    `).join('');

    tbody.innerHTML = html;
}

// 渲染状态分布图表
function renderStatusChart(filteredBugs = null) {
    const ctx = document.getElementById('statusChart').getContext('2d');

    // 使用筛选后的数据或全部数据
    const dataToUse = filteredBugs || bugs;

    // 统计各状态数量
    const statusCounts = {};
    dataToUse.forEach(bug => {
        statusCounts[bug.status] = (statusCounts[bug.status] || 0) + 1;
    });
    
    // 定义状态顺序和对应颜色
    const statusOrder = ['待处理', '已分配', '处理中', '已解决', '已完成'];
    const statusColors = {
        '待处理': '#ffa726',
        '已分配': '#42a5f5',
        '处理中': '#66bb6a',
        '已解决': '#ab47bc',
        '已完成': '#ef5350'
    };

    // 按照预定义顺序排列数据
    const labels = [];
    const data = [];
    const colors = [];

    statusOrder.forEach(status => {
        if (statusCounts[status] && statusCounts[status] > 0) {
            labels.push(status);
            data.push(statusCounts[status]);
            colors.push(statusColors[status]);
        }
    });
    
    if (statusChart) {
        statusChart.destroy();
    }
    
    statusChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: colors,
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                },
                datalabels: {
                    display: true,
                    color: 'white',
                    font: {
                        weight: 'bold',
                        size: 14
                    },
                    formatter: (value, context) => {
                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                        const percentage = ((value / total) * 100).toFixed(1);
                        return `${value}\n(${percentage}%)`;
                    },
                    textAlign: 'center'
                }
            }
        },
        plugins: [ChartDataLabels]
    });
}

// 工具函数
function getStatusClass(status) {
    const statusMap = {
        '待处理': 'pending',
        '已分配': 'assigned',
        '处理中': 'processing',
        '已解决': 'resolved',
        '已驳回': 'rejected',
        '已完成': 'completed'
    };
    return statusMap[status] || 'pending';
}

// 按团队筛选Bug
function filterByTeam(teamName) {
    const filteredBugs = bugs.filter(bug => bug.assignee_team === teamName);
    console.log('Filtering by team:', teamName);
    console.log('Filtered bugs:', filteredBugs);
    
    renderBugsTable(filteredBugs);
    renderStatusChart(filteredBugs); // 也更新图表

    // 更新页面标题显示当前筛选的团队
    const title = document.querySelector('.card-title');
    if (title) {
        title.innerHTML = `<i class="fas fa-list"></i> ${teamName} 团队问题列表 (${filteredBugs.length})`;
    }
}

// 显示团队问题（快捷操作）
function showTeamIssues() {
    // 滚动到问题列表区域
    document.querySelector('.content-grid').scrollIntoView({ behavior: 'smooth' });
}

function formatDate(dateStr) {
    if (!dateStr) return '-';
    const date = new Date(dateStr);
    return date.toLocaleDateString('zh-CN');
}

// 按产品线筛选
function filterByProductLine(productLineName) {
    // 更新按钮激活状态
    document.querySelectorAll('.product-line-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelectorAll('.team-stat-item').forEach(item => {
        item.classList.remove('active');
    });

    // 激活当前选中的按钮和团队项
    const selectedBtn = Array.from(document.querySelectorAll('.product-line-btn')).find(btn =>
        btn.textContent.includes(productLineName)
    );
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }

    const selectedTeam = Array.from(document.querySelectorAll('.team-stat-item')).find(item =>
        item.querySelector('.team-name').textContent === productLineName
    );
    if (selectedTeam) {
        selectedTeam.classList.add('active');
    }

    // 筛选问题列表
    const filteredBugs = bugs.filter(bug => bug.assignee_team === productLineName);
    console.log('Filtering bugs for team:', productLineName);
    console.log('Filtered bugs:', filteredBugs);
    
    renderBugsTable(filteredBugs);
    renderStatusChart(filteredBugs); // 更新图表显示筛选后的数据

    // 更新问题列表标题
    const bugsTitle = document.querySelector('.bugs-table-container .card-title');
    if (bugsTitle) {
        bugsTitle.innerHTML = `<i class="fas fa-list"></i> ${productLineName} - 问题列表 (${filteredBugs.length})`;
    }
}

// 显示所有问题
function showAllIssues() {
    // 移除所有激活状态
    document.querySelectorAll('.product-line-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelectorAll('.team-stat-item').forEach(item => {
        item.classList.remove('active');
    });

    // 显示所有问题
    renderBugsTable();
    renderStatusChart(); // 恢复显示所有数据的图表

    // 恢复问题列表标题
    const bugsTitle = document.querySelector('.bugs-table-container .card-title');
    if (bugsTitle) {
        bugsTitle.innerHTML = `<i class="fas fa-list"></i> 我的团队问题列表 (${bugs.length})`;
    }
}
</script>

{% endblock %}
